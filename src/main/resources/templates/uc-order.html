<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>订单</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link href="/css/iconfont/iconfont.css" rel="stylesheet" />
    <link href="/css/common.css" rel="stylesheet" />
    <link href="/css/uc.css" rel="stylesheet" />
</head>


<body>
    <!--头部-->
    <div class="topper">
        <div class="wrapper">
            <div class="left-bar">
                <div class="back-home divider">
                    <em></em><a href="index.html">商城首页</a>
                </div>
                <div class="item"><a href="shangjia.html">商家中心</a></div>
            </div>
            <div class="right-bar">
                <div class="login-user sub-menu">
                    <a class="menu-hd" href="uc.html">个人中心<em></em></a>
                    <div class="down">
                        <a href="">内容</a>
                        <a href="">内容</a>
                        <a href="">内容</a>
                    </div>
                </div>
                <div class="item"><a href="uc-msg.html">消息（<span class="txt-theme">0</span>）</a></div>
                <div class="logout divider"><a onclick="logout()">退出</a></div>
                <span class=""></span>
                <div class="cart"><em></em><a onclick="goCart()">购物车<span class="txt-theme" id="cartNums">0</span>件</a></div>
                <div class="order"><em></em><a onclick="ucorder()">我的订单</a></div>
                <div class="fav"><em></em><a href="uc-fav.html">我的收藏</a></div>
                <div class="help"><em></em><a href="">帮助中心</a></div>
            </div>
        </div>
    </div>
    <div class="uc-header-bg">
        <div class="uc-header wrapper">
            <a class="logo" href="index.html"><img src="/img/logo2.png" alt="" /></a>
            <div class="back-home"><a href="index.html">返回商城首页</a></div>
            <ul class="uc-nav">
                <li><a href="uc.html">首页</a></li>
                <li class="toggle">
                    <span class="label">账户设置<i class="iconfont"></i></span>
                    <div class="toggle-cont">
                        <a href="uc-account.html">个人信息</a>
                        <a href="uc-safe.html">安全设置</a>
                        <a href="uc-address.html">收货地址</a>
                    </div>
                </li>
                <li><a href="uc-evaluate.html">消息中心</a></li>
            </ul>
            <div class="schbox">
                <form action="">
                    <input class="search-txt" type="text" />
                    <button class="search-btn">搜索</button>
                    <div class="suggest-box">
                        <div class="item" data-title="上衣 短款 短袖">上衣 短款 短袖
                            <div class="tags"><span>雪纺</span><span>蕾丝</span><span>一字领</span></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="wrapper uc-router">
        <ul>
            <li><a href="uc.html">首页</a></li>
            <li><span class="divider"></span></li>
            <li><span>个人中心</span></li>
        </ul>
    </div>

    <div class="wrapper">
        <div class="uc-main clearfix">
            <div class="uc-aside">
                <div class="uc-menu">
                    <div class="tit">订单中心</div>
                    <ul class="sublist">
                        <li><a href="uc-order.html">我的订单</a></li>
                        <li><a href="uc-fav.html">我的收藏</a></li>
                        <li><a href="uc-footprint.html">浏览历史</a></li>
                    </ul>
                    <div class="tit">客户服务</div>
                    <ul class="sublist">
                        <li><a href="">取消订单记录</a></li>
                        <li><a href="uc-refund.html">退款/退货</a></li>
                    </ul>
                    <div class="tit">账户中心</div>
                    <ul class="sublist">
                        <li><a href="uc-account.html">账户信息</a></li>
                        <li><a href="uc-safe.html">账户安全</a></li>
                        <li><a href="">消费记录</a></li>
                        <li><a href="uc-address.html">收货地址</a></li>
                    </ul>
                    <div class="tit">消息中心</div>
                    <ul class="sublist">
                        <li><a href="uc-evaluate.html">商品评价</a></li>
                        <li><a href="uc-msg.html">我的私信</a></li>
                    </ul>
                </div>
            </div>
            <div class="uc-content">
                <div class="uc-panel">
                    <div class="uc-bigtit">我的订单</div>
                    <div class="uc-panel-bd">
                        <div class="uc-sort">
                            <div class="uc-tabs">
                                <a class="item active" onclick="allOrder(1)">所有订单</a>
                                <!--   <a class="item" onclick="payIng()">待付款（1）</a>-->
                                <a class="item" onclick="senging(20)">待发货</a>
                                <a class="item" onclick="receiveing(40)">待收货</a>
                            </div>
                            <div class="uc-search">
                                <form action="">
                                    <input type="text" class="sch-input" placeholder="输入商品名称,订单号，商品编号" />
                                    <button class="sch-btn"><i class="iconfont icon-search"></i></button>
                                </form>
                            </div>
                        </div>
                        <table class="uc-table" id="table1">
                            <!--    <thead>
                                <td>
                                    </th>
                                    <th></th>
                                    <th></th>
                                    <th width="120"></th>
                            </thead>-->
                            <!--   <tr class="hd order-meta">
                                <td colspan="4">
                                    <div class="left">2016-05-29 订单号: 1947584672162364</div>
                                    <div class="right">店铺：<a href="">小米旗舰店</a> <span class="del iconfont icon-shanchu"></span></div>
                                </td>
                            </tr>
                            <tr class="order-goods">
                                <td>
                                    <div class="goods-info">
                                        <img class="figure" src="img/uc/11.jpg" alt="" />
                                        <a class="text-info refund" href="uc-apply-refund.html">申请退货</a>
                                        <div class="info">
                                            <div>小米短袖T恤 五彩换 黑色 S</div>
                                            <div>499元×1</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    金额：<span class="text-theme fwb">298.00元</span>
                                </td>
                                <td>
                                    <span class="status">快件已签收</span><br />
                                </td>

                            </tr>-->

                            <!--        <tr class="hd order-meta">
                                <td colspan="4">
                                    <div class="left">2016-05-29 订单号: 1947584672162364</div>
                                    <div class="right">店铺：<a href="">小米旗舰店</a> <span class="del iconfont icon-shanchu"></span></div>
                                </td>
                            </tr>
                            <tr class="order-goods">
                                <td>
                                    <div class="goods-info">
                                        <img class="figure" src="img/uc/11.jpg" alt="" />
                                        <a class="text-info refund" href="uc-apply-refund.html">申请退货</a>
                                        <div class="info">
                                            <div>小米短袖T恤 五彩换 黑色 S</div>
                                            <div>499元×1</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    金额：<span class="text-theme fwb">298.00元</span>
                                </td>
                                <td>
                                    <span class="status">快件已签收</span><br />
                                    <a class="text-info" href="uc-order-detail.html">订单详情</a><br />
                                    <a class="text-info" href="">查看物流</a>
                                </td>
                                <td>
                                    <a href="" class="ui-btn-theme uc-btn-md">去付款</a>
                                    <a href="" class="ui-btn-low ui-btn-hollow uc-btn-md mt10">取消订单</a>
                                </td>
                            </tr>

                            <tr class="hd order-meta">
                                <td colspan="4">
                                    <div class="left">2016-05-29 订单号: 1947584672162364</div>
                                    <div class="right">店铺：<a href="">小米旗舰店</a> <span class="del iconfont icon-shanchu"></span></div>
                                </td>
                            </tr>
                            <tr class="order-goods">
                                <td>
                                    <div class="goods-info">
                                        <img class="figure" src="img/uc/11.jpg" alt="" />
                                        <a class="text-info refund" href="uc-apply-refund.html">申请退货</a>
                                        <div class="info">
                                            <div>小米短袖T恤 五彩换 黑色 S</div>
                                            <div>499元×1</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    金额：<span class="text-theme fwb">298.00元</span>
                                </td>
                                <td>
                                    <span class="status">快件已签收</span><br />
                                    <a class="text-info" href="uc-order-detail.html">订单详情</a><br />
                                    <a class="text-info" href="">查看物流</a>
                                </td>
                                <td>
                                    <div class="time-left"><i class="iconfont icon-shijian"></i>还剩2天8时</div>
                                    <a href="" class="ui-btn-theme uc-btn-md">确认收货</a>
                                </td>
                            </tr>-->
                            <!-- <a class="page" href="">1</a>
                            <a class="page" href="">2</a>
                            <a class="page" href="">3</a>
                            <a class="page" href="">4</a>
                            <i class="page-split">...</i>
                            <a class="page" href="">71</a>-->
                        </table>
                        <div class="pages" id="page2">

                        </div>

                        <!--        <div class="ta-c">
                            <ul class="pagination">
                                <li class="disabled"><a href="#" aria-label="Previous"><span aria-hidden="true">«</span></a></li>
                                <li class="active"><a href="#">1 <span class="sr-only">(current)</span></a></li>
                                <li><a href="#">2</a></li>
                                <li><a href="#">3</a></li>
                                <li><a href="#">4</a></li>
                                <li><a href="#">5</a></li>
                                <li><a href="#" aria-label="Next"><span aria-hidden="true">»</span></a></li>
                            </ul>
                        </div>-->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--脚部-->
    <div class="fatfooter">

    </div>
    <!--脚部-->
</body>
<script src="/js/jquery.js"></script>
<link rel="stylesheet" href="/js/icheck/style.css" />
<script src="/js/icheck/icheck.min.js"></script>
<script src="/js/global.js"></script>
<script>
    var token = localStorage.getItem("token");

    allOrder(1);

    function allOrder(page) {
        $("#page2").empty();
        $("#table1").empty()
        $.ajax({
            async: false,
            headers: {
                tokenstring: token
            },
            url: base + "/orders/findOrdersByUser",
            data: {
                page: page,
                limit: 2
            },
            success: function(data) {
                console.log(data)
                const item = data.data.orders;
                for (let i = 0; i < item.length; i++) {
                    var div11 = $("  <tr class=\"hd order-meta\">\n" +
                        "                                <td colspan=\"4\">\n" +
                        "                                    <div class=\"left\" id='orderid'>" + item[i].aa + " 订单号:" + item[i].orderid + " </div>\n" +
                        "                                    <div class=\"right\">店铺：<a href=\"\">小米旗舰店</a> </div>\n" +
                        "                                </td>\n" +
                        "                            </tr>")
                    var or = $("<input type='hidden' name='orderid' value=' " + item[i].orderid + " '>")

                    $("#table1").append(div11, or)
                    const item1 = item[i].ordritem;
                    for (let j = 0; j < item1.length; j++) {
                        var ie;
                        if (item[i].status === 20) {
                            ie = "等待发货"
                        }
                        if (item[i].status === 40) {
                            ie = "等待收货"
                        }
                        if (item[i].status === 50) {
                            ie = "交易成功"
                        }

                        var div33 = $("   <tr class=\"order-goods\">\n" +
                            "                                <td>\n" +
                            "                                    <div class=\"goods-info\">\n" +
                            "                                        <img class=\"figure\" src='" + "http://192.168.1.92:8080/img/mainImg/" + item1[j].product.mainimage + "' alt=\"\" />\n" +
                            "                                        <div class=\"info\">\n" +
                            "                                            <div>" + item1[j].product.pname + "</div>\n" +
                            "                                            <div>" + item1[j].product.price + "*" + item1[j].quantity + "</div>\n" +
                            "                                        </div>\n" +
                            "                                    </div>\n" +
                            "                                </td>\n" +
                            "                                <td>\n" +
                            "                                    金额：<span class=\"text-theme fwb\">" + item1[j].quantity * item1[j].product.price + "元</span>\n" +
                            "                                </td>\n" +
                            "                                <td>\n" +
                            "                                    <span class=\"status\">" + ie + "</span><br />\n" +
                            "                                </td>\n" +
                            "                            \n" +
                            "                            </tr>")
                        $("#table1").append(div33);
                    }
                }
                /*  var pageNum=data.data.pageInfo.pageNum;
                  var pre=pageNum-1;
                  var nex=pageNum+1
                  var div444=$("<a class=\"page prev\" href=\"\" onclick='allOrder("+pre+")'>上一页</a>\n");
                  $("#page2").append(div444);
                   var list=data.data.pageInfo.pages;
                  for (let i = 1; i <=list; i++) {
                      var div456=$("<a class=\"page\" href=\"\" onclick='allOrder("+ i+")'>"+ i+"</a>")
                      $("#page2").append(div456);
                  }
                  var div4555=$("<a class=\"page next\" href=\"\" onclick='allOrder("+nex +")'>下一页</a>\n");
                  $("#page2").append(div4555);*/

            }


        })
    }

    //查找待发货的订单
    function senging(status) {
        $("#page2").empty()
        $("#table1").empty()
        $.ajax({
            async: false,
            headers: {
                tokenstring: token
            },
            url: base + "/orders/findOrdersByUserStatus",
            data: {
                status: status
            },
            success: function(data) {
                const item = data.data.orders;
                console.log(data.data.orders)
                for (let i = 0; i < item.length; i++) {
                    var div11 = $("  <tr class=\"hd order-meta\">\n" +
                        "                                <td colspan=\"4\">\n" +
                        "                                    <div class=\"left\">" + item[i].aa + " 订单号:" + item[i].orderid + " </div>\n" +
                        "                                    <div class=\"right\">店铺：<a href=\"\">小米旗舰店</a> </div>\n" +
                        "                                </td>\n" +
                        "                            </tr>")

                    $("#table1").append(div11)
                    const item1 = item[i].ordritem;
                    for (let j = 0; j < item1.length; j++) {
                        var div33 = $("   <tr class=\"order-goods\">\n" +
                            "                                <td>\n" +
                            "                                    <div class=\"goods-info\">\n" +
                            "                                        <img class=\"figure\" src='" + "http://192.168.1.92:8080/img/mainImg/" + item1[j].product.mainimage + "' alt=\"\" />\n" +
                            "                                        <div class=\"info\">\n" +
                            "                                            <div>" + item1[j].product.pname + "</div>\n" +
                            "                                            <div>" + item1[j].product.price + "*" + item1[j].quantity + "</div>\n" +
                            "                                        </div>\n" +
                            "                                    </div>\n" +
                            "                                </td>\n" +
                            "                                <td>\n" +
                            "                                    金额：<span class=\"text-theme fwb\">" + item1[j].quantity * item1[j].product.price + "元</span>\n" +
                            "                                </td>\n" +
                            "                                <td>\n" +
                            "                                    <span class=\"status\">等待发货</span><br />\n" +
                            "                                </td>\n" +
                            "                            \n" +
                            "                            </tr>")
                        $("#table1").append(div33);
                    }
                }

            }

        })
    }

    function receiveing(status) {

        $("#table1").empty()
        $.ajax({
            headers: {
                tokenstring: token
            },
            url: base + "/orders/findOrdersByUserStatus",
            data: {
                status: status
            },
            success: function(data) {
                const item = data.data.orders;
                console.log(data.data.orders)
                for (let i = 0; i < item.length; i++) {
                    var div11 = $("  <tr class=\"hd order-meta\">\n" +
                        "                                <td colspan=\"4\">\n" +
                        "                                    <div class=\"left\" id='orderid'>" + item[i].aa + " 订单号:" + item[i].orderid + " </div>\n" +
                        "                                    <div class=\"right\">店铺：<a href=\"\">小米旗舰店</a><button onclick='receive(" + item[i].orderid + ")'>收货</button> </div>\n" +
                        "                                </td>\n" +
                        "                            </tr>")
                    var or = $("<input type='hidden' name='orderid' value=' " + item[i].orderid + " '>")

                    $("#table1").append(div11, or)
                    const item1 = item[i].ordritem;
                    for (let j = 0; j < item1.length; j++) {
                        var div33 = $("   <tr class=\"order-goods\">\n" +
                            "                                <td>\n" +
                            "                                    <div class=\"goods-info\">\n" +
                            "                                        <img class=\"figure\" src='" + "http://192.168.1.92:8080/img/mainImg/" + item1[j].product.mainimage + "' alt=\"\" />\n" +
                            "                                        <div class=\"info\">\n" +
                            "                                            <div>" + item1[j].product.pname + "</div>\n" +
                            "                                            <div>" + item1[j].product.price + "*" + item1[j].quantity + "</div>\n" +
                            "                                        </div>\n" +
                            "                                    </div>\n" +
                            "                                </td>\n" +
                            "                                <td>\n" +
                            "                                    金额：<span class=\"text-theme fwb\">" + item1[j].quantity * item1[j].product.price + "元</span>\n" +
                            "                                </td>\n" +
                            "                                <td>\n" +
                            "                                    <span class=\"status\"></span><br />\n" +
                            "                                </td>\n" +
                            "                            \n" +
                            "                            </tr>")
                        $("#table1").append(div33);
                    }

                }


            }

        })
    }
    //收货
    function receive(id) {
        alert("确定收货吗")
        $.ajax({
            headers: {
                tokenstring: token
            },
            url: base + "/orders/receving",
            data: {
                orderid: id
            },
            type: "get",
            success: function(data) {
                alert("收货成功!")
                receiveing(40);
            }
        })
    };

    getCartNums();

    function getCartNums() {
        $.ajax({
            headers: {
                token
            },
            url: base + "/cart/findNumber",
            success: function(res) {
                $("#cartNums").html(res.data.nums);
                console.log("更新购物车数量成功:" + res.data.nums)
            }
        })
    };
</script>

</html>